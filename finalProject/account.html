<!DOCTYPE>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <title>SCU IT Bug Reporting Program</title>

</head>

<body style="margin:25">
    <a href="table.html">
        <button type="button" class="btn btn-default ">Table</button>
    </a>
    <!--<a href = "index.html"> -->
    <!--  <button type="button" class="btn btn-default">Home</button></a> -->
   <!-- <div class="btn-group" role="group" aria-label="...">-->
        <!--  <a href = "tester.html" class="btn btn-default">Tester</a> -->
    <a href="manager.html" class="btn btn-default">Manager</a>
    <a href="account.html" class="btn btn-default disabled">Create Account</a>
    </div>

    <form style="width:200px; float:right" align="right">
        <input id="logoutid" type="button" value="Logout" onClick="logout();" />
    </form>

    <br>
    <br>
    <div class="container">
        <div class="row">
            <center> <h2><strong>Create Account</strong> </a> <br /></h2><br /> </center>
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <!-- Start form -->
                <form>
                    <div class="form-group">
                        <label for="formGroupExampleInput">Username</label>
                        <input type="text" class="form-control" id="usernameBox" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <label for="exampleInputPassword1">Password</label>
                        <input type="password" class="form-control" name="password" id="passwordBox" placeholder="Password">
                    </div>

                    <div class="form-group">
                        <label for="exampleFormControlSelect1">Permission</label>
                        <select class="form-control" id="exampleFormControlSelect1">
                            <option>tester</option>
                            <option>developer</option>
                        </select>
                    </div>
                    <div class="form-check">
                        <input id="logoutid" type="button" value="Submit" onClick="makeAccount();" />
                    </div>

                </form>

                <!-- End form -->

            </div>
        </div>
    </div>

    <script type="text/javascript">
        function makeAccount() {

            var username = document.getElementById("usernameBox").value;
            var password = document.getElementById("passwordBox").value;
            var permission = document.getElementById("exampleFormControlSelect1").value;

            console.log(username);
            console.log(permission);

            if (username == "" || password == "" || username.trim().length == 0 || password.trim().length == 0) {
                alert("No Credentials Inputted")
                return;
            }
            var data = JSON.stringify({ "username": username, "password": password, "permission": permission });

            $.ajax({
                url: "https://052stnmylg.execute-api.us-west-1.amazonaws.com/firstTest/makeAccount",
                data: data,
                type: "POST",
                beforeSend: function(xhr) {
                    xhr.setRequestHeader('x-api-key', 'bDXQekjXMm7IXoCkwT1MO4yzySMzrHK880HBR23t');
                },
                success: function (data) {
                    if (data == '-1') {
                        alert("Username already taken")
                        document.getElementById("usernameBox").value = "";
                        document.getElementById("passwordBox").value = "";
                        return;
                    }
                    alert("Success! Created" + permission + "with Username: " + username)

                }
            })

        }

        function logout() {
            sessionStorage.setItem("username", " ");
            sessionStorage.setItem("permission", " ");

            document.location.href = "index.html";
        }

        var permission = sessionStorage.getItem('permission');

        if (permission != "manager") {
            document.location.href = "index.html";
        }

    </script>
</body>
</html>
