<!DOCTYPE>
<html>
<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">

<title> SCU IT Bug Tracker Program </title>
</head>
<body>
<script type="text/javascript">

function createItem() {
	var x = document.getElementById("addBug");
	
	var sys = x.elements[0].value;
	var des = x.elements[1].value;
	var doi = x.elements[2].value;
	console.log(sys);
	console.log(des);
	console.log(doi);

	if (des.trim().length == 0) {
	    alert("Please Fill Out Description")
	    return;
	}

	if (doi.trim().length == 0) doi = " ";
	
	var data = "description=" + des +"&details="+doi + "&system="+sys ;
	$.ajax({
		url: "https://052stnmylg.execute-api.us-west-1.amazonaws.com/firstTest/createForm",
		data: data,
		type: "GET",
		beforeSend: function(xhr) {
			xhr.setRequestHeader('x-api-key', 'NZLlovyCrO83qyPR4IXNl7ARqF9nLaFn2EZp7AlL');
		},
		success: function (data) {
			alert("Success!" + JSON.stringify(data))
			document.getElementById("uniqueCode").innerHTML= "The unique code for the bug you found is " + JSON.stringify(data);
		}

	})
		
}

function readItem() {
	var x = document.getElementById("read");
	var id = x.elements[0].value;

	var data = "id=" + id;
	
	$.ajax({
		url: "https://052stnmylg.execute-api.us-west-1.amazonaws.com/firstTest/getForm",
		data: data,
		type: "GET",
		beforeSend: function(xhr) {
			xhr.setRequestHeader('x-api-key', 'NZLlovyCrO83qyPR4IXNl7ARqF9nLaFn2EZp7AlL');
		},
		success: function (data) {
			alert("Success!" + JSON.stringify(data))
			document.getElementById("bugStatusID").innerHTML="Bug ID: " + data['code'];
			document.getElementById("bugStatusDescr").innerHTML = "Description: " + data['description'];
			document.getElementById("bugStatusDoing").innerHTML= "Details: " + data['details'];
			document.getElementById("bugStatusStatus").innerHTML="Status: " + data['status'];
		}
	 })
		
}

function login() {
	var username = document.getElementById("username").value;
	var password = document.getElementById("password").value;

	if (username.trim().length == 0 || password.trim().length == 0) {
        alert("Please Fill Out Credentials")
	    return;
	}

	// console.log(username);
	// console.log(password);
	var data = JSON.stringify({password: password, username: username});

	$.ajax({
		url: "https://052stnmylg.execute-api.us-west-1.amazonaws.com/firstTest/login",
		data: data,
		type: "POST",
		beforeSend: function(xhr) {
			xhr.setRequestHeader('x-api-key', 'qsC4GkBInl9l8EA9AsvRc6Le4W3EhCHd9uWb88S3');
		},
		success: function (data) {
			if(data == '-1') {
				alert("Incorrect Credentials")
				document.getElementById("username").value = "";
				document.getElementById("password").value = "";
				return;
			}
			sessionStorage.setItem('permission',data);
			sessionStorage.setItem('username',username);
			console.log(data);
			if(data == "tester") {
				document.location.href = "tester.html";
			}
			else if(data == "developer") {
				document.location.href = "developer.html";
			}
			else if(data == "manager") {
				document.location.href = "manager.html";
			}


		}
	})

	// console.log(username);
 	// sessionStorage.setItem('username',username); 
	document.getElementById("username").value="";
	document.getElementById("password").value="";


}

sessionStorage.setItem('username', " ");
sessionStorage.setItem('permission', " ");

</script>
</head>

<body style="margin:25">
	<!-- <a href = "table.html"> -->
		<!-- <button type="button" class="btn btn-default">Table</button></a> -->
	<!-- <a href = "index.html">  -->
		<!-- <button type="button" class="btn btn-default disabled">Home</button></a> -->
	<div class="btn-group" role="group" aria-label="...">
		<!-- <a href = "tester.html" class="btn btn-default">Tester</a> -->
		<!-- <a href="developer.html" class="btn btn-default">Developer</a> -->
		<!-- <a href="manager.html" class="btn btn-default">Manager</a> -->
	</div>
	
	<!-- login -->
	<form style="width:200px; float:right" align="right">
  <div class="form-group">
	<input type="text" class="form-control" id="username"  placeholder="Enter username">
	<input type="password" class="form-control" id="password" placeholder="Password">
  <input id="usernameSubmit" type="button" value="Login" onclick="login();" />
  <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
</div>
</form>

	<br>
	<br>
	<br>
	<br>



  <form id="addBug">
  	<div class="form-group">
    <label for="exampleFormControlSelect1">System being used</label>
    <select class="form-control" id="exampleFormControlSelect1">
      <option>CourseAvail</option>
      <option>Camino</option>
      <option>eCampus</option>
    </select>
  </div>

	<div class="form-group">
	<label for="description">Description of the bug:</label>
	<textarea class="form-control" id="description" rows="3" placeholder="Description" type="text"></textarea>
	</div>

	<div class="form-group">
	<label for="during">What were you doing when you encountered the bug?</label>
	<textarea class="form-control" id="during" rows="3" placeholder="What you were doing" type="text"></textarea>
	</div>
		
	<input id="Submit1" type="button" value="Create Item" onclick="createItem();" />
</form>
<br>
<p id="uniqueCode"></p>

<br>
<form id="read">
  <div>
	<label for="bugID">If you already submitted this form, please input your unique code to check on the status of your bug.</label>
	<input type="text" class="form-control" id="bugID2" placeholder="Unique Code">
  </div>
  <br>
  <input id="Submit2" type="button" value="Look At Item" onclick="readItem();" />
</form>

<br>
<p id = "bugStatusID"></p>
<p id = "bugStatusDescr"></p>
<p id = "bugStatusDoing"></p>
<p id = "bugStatusStatus"></p>
</body>
</html>
